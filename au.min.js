/*
 *  Project: bootstrap-au
 *  Version: 0.5
 *  Author: Renhard Julindra
 *  License: MIT License
 */
!function(e,t,i,s){var l="au",a="plugin_"+l,o=function(e,t){this.element=e,this.f=!1,this.options={min:3,delay:300,type:"POST",url:"",param:"q",cur_value:"",cur_text:""},this.init(t)};o.prototype={init:function(t){e.extend(this.options,t);var i=this.element,s=this.options;if(s.min<0)return void alert("Minimum characters must be >= 0");if(s.delay<0)return void alert("Delay must be >= 0");if("post"!=s.type.toLowerCase()&&"get"!=s.type.toLowerCase())return void alert("Request Type must be either POST or GET");if(""==s.url)return void alert("URL is required");au_html='<input class="form-control au-input"> <div class="au-message" style="display: none;"> <ul class="list-group"> <li class="list-group-item text-center"></li> </ul> </div> <div class="au-select" style="display: none;"> <ul class="list-group"> </ul> </div>',i.hide(),i.after(au_html);var l=i.closest("div").find(".au-input"),a=i.closest("div").find(".au-select"),o=i.closest("div").find(".au-message");""!=s.cur_value&&(l.val(s.cur_text),i.html('<option value="'+s.cur_value+'" selected>'+s.cur_text+"</option>")),i.closest("div").on("click focus",".au-input",function(e){a.width(l.outerWidth(!0)),o.width(l.outerWidth(!0)),s.min>0?(o.find(".list-group-item").text("Please enter "+s.min+" or more characters"),i.val()||"none"!=o.css("display")||o.show()):i.val()||l.keyup(),e.stopPropagation()}),e("body").click(function(e){return i.val()||(l.val(""),this.f=!1),"none"!=a.css("display")&&a.hide(),"none"!=o.css("display")?(o.hide(),void e.preventDefault()):void 0}),i.closest("div").on("keydown",".au-input",function(t){var s=a.find(".list-group-item.active"),o=l.val();if(40==t.keyCode){if(s.length>0&&s.next("li").length>0)return s.next("li").addClass("active"),void s.removeClass("active");a.find(".list-group-item").removeClass("active"),a.find(".list-group-item").first().addClass("active")}else if(38==t.keyCode){if(s.length>0&&s.prev("li").length>0)return s.prev("li").addClass("active"),void s.removeClass("active");a.find(".list-group-item").removeClass("active"),a.find(".list-group-item").last().addClass("active")}else if(27==t.keyCode)e("body").click(),l.blur();else{if(13==t.keyCode){if(s.length>0){var n=s.text(),r=s.attr("data-au-value");l.val(n),i.html('<option value="'+r+'" selected>'+n+"</option>"),e("body").click(),this.f=!0}return void t.preventDefault()}if(8==t.keyCode)i.val()&&(l.val(""),i.val(""),i.html(""),this.f=!1);else if(i.val()&&""!=o&&this.f)return void t.preventDefault()}}),i.closest("div").on("keyup",".au-input",function(t){var n=l.val();if(40!=t.keyCode&&38!=t.keyCode&&27!=t.keyCode&&13!=t.keyCode&&8!=t.keyCode){if(i.val()&&""!=n&&this.f)return void t.preventDefault();n.length<s.min?(o.find(".list-group-item").text("Please enter "+(s.min-n.length)+" or more characters"),a.hide(),o.show()):(o.find(".list-group-item").text("Loading"),a.hide(),o.show(),setTimeout(function(){e.ajax({type:s.type,url:s.url,data:s.param+"="+n,dataType:"json",success:function(e){if(a.find(".list-group").html(""),e.length>0){if(e.length>=5)for(var t=0;5>t;t++)a.find(".list-group").append('<li class="list-group-item" data-au-value="'+e[t].id+'">'+e[t].text+"</li>");else for(var t=0;t<e.length;t++)a.find(".list-group").append('<li class="list-group-item" data-au-value="'+e[t].id+'">'+e[t].text+"</li>");o.hide(),a.show()}else o.find(".list-group-item").text("Not Found"),a.hide(),o.show()}})},s.delay))}else 8==t.keyCode&&(n.length<s.min?(o.find(".list-group-item").text("Please enter "+(s.min-n.length)+" or more characters"),a.hide(),o.show()):(o.find(".list-group-item").text("Loading"),a.hide(),o.show(),setTimeout(function(){e.ajax({type:s.type,url:s.url,data:s.param+"="+n,dataType:"json",success:function(e){if(a.find(".list-group").html(""),e.length>0){if(e.length>=5)for(var t=0;5>t;t++)a.find(".list-group").append('<li class="list-group-item" data-au-value="'+e[t].id+'">'+e[t].text+"</li>");else for(var t=0;t<e.length;t++)a.find(".list-group").append('<li class="list-group-item" data-au-value="'+e[t].id+'">'+e[t].text+"</li>");o.hide(),a.show()}else o.find(".list-group-item").text("Not Found"),a.hide(),o.show()}})},s.delay)))}),i.closest("div").on("mouseover",".au-select .list-group-item",function(){var t=e(this);a.find(".list-group-item").removeClass("active"),t.addClass("active")}),i.closest("div").on("click",".au-select .list-group-item",function(){var t=e(this),s=t.text(),a=t.attr("data-au-value");l.val(s),i.html('<option value="'+a+'" selected>'+s+"</option>"),this.f=!0})},destroy:function(){this.f=!1}},e.fn[l]=function(e){var t=this.data(a);return t instanceof o?"undefined"!=typeof e&&t.init(e):(t=new o(this,e),this.data(a,t)),t}}(jQuery,window,document);